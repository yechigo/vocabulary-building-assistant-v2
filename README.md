# 英語学習アプリ v2

Google Cloud Text-to-Speech APIを使用した高品質な音声で英語学習ができるWebアプリです。

## 🌐 デモ

https://yechigo.github.io/vocabulary-building-assistant-v2/

## ✨ 主な機能

### 音声再生
- **Google Cloud Text-to-Speech API**: 高品質で自然な音声合成
- **音声キャッシュ**: 一度再生した音声はブラウザにキャッシュ、2回目以降はAPI呼び出しなしで即座に再生
- **ロック画面対応**: Safariブラウザでロック中も音声再生が継続（Media Session API）
- **待機時間調整**: 日本語と英語の間の待機時間を0〜30秒で設定可能（0.5秒刻み）

### 学習機能
- **シャッフル再生**: ランダム順で学習可能。再生中の切り替えにも対応
- **ループモード**: 全センテンスを繰り返し再生、またはワンパスで停止
- **ナビゲーション**: 前へ/次へボタンで自由に移動
- **自動データ読み込み**: ページ起動時と停止時に自動的に最新データを取得

### データ連携
- **Google Sheets連携**: Google Apps Script経由でシートからデータを取得
- **自動更新**: 停止時に最新データを自動読み込み

## 📋 初回設定

### 1. Google Cloud TTS API の設定（10分程度）

#### Google Cloud Console にアクセス
https://console.cloud.google.com/

#### プロジェクトを作成
1. 画面上部の「プロジェクトの選択」をクリック
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を入力（例: `english-learning-app`）
4. 「作成」をクリック

#### Text-to-Speech API を有効化
1. 左側メニュー「APIとサービス」→「ライブラリ」
2. 「Text-to-Speech」で検索
3. 「Cloud Text-to-Speech API」を選択
4. 「有効にする」をクリック

#### APIキーを作成
1. 左側メニュー「APIとサービス」→「認証情報」
2. 「認証情報を作成」→「APIキー」
3. APIキーをコピーして保存

#### APIキーを制限（推奨）
1. 作成したAPIキーの「編集」をクリック
2. 「APIの制限」で「キーを制限」を選択
3. 「Cloud Text-to-Speech API」のみにチェック
4. 「保存」をクリック

### 2. Google Apps Script の設定

既存のv1で設定済みのGoogle Apps Scriptをそのまま使用できます。

設定方法の詳細は別途ドキュメントを参照してください。

### 3. アプリでAPIキーを設定

1. アプリを開く
2. 「⚙️ 設定を開く」をクリック
3. Google Cloud TTS API 設定にAPIキーを貼り付け
4. 「API キーを保存」をクリック

## 📱 使い方

### 基本的な使い方

1. **アプリを開く**
   - ブラウザで `english-learning-app.html` を開く
   - または GitHub Pages の URL にアクセス

2. **再生開始**
   - ▶ボタンをクリックして学習開始
   - データは自動的に読み込まれます

3. **操作**
   - ⏮ 前のセンテンスへ
   - ▶/⏸ 再生/一時停止
   - ⏭ 次のセンテンスへ
   - 停止して最初に戻る（最新データを自動読み込み）

### オプション設定

- **🔀 シャッフル**: ランダム順で再生（再生中の切り替え可能）
- **🔁 ループ**: チェックで無限ループ、オフで1回通して停止
- **待機時間**: 日本語と英語の間の間隔（0〜30秒、デフォルト3秒）
- **開始行/終了行**: Google Sheetsの読み込み範囲
- **和訳の列/英文の列**: Sheetsの列指定

### ロック画面での使用（Safari推奨）

1. **Safari**でアプリを開く
2. 再生開始
3. スマホをロック
4. ロック画面に再生コントロールが表示されます

**注意事項:**
- iOS Chromeではロック画面コントロールに制限があります
- PWAモード（ホーム画面に追加）ではロック画面からの再生再開に制限があります
- 安定した動作のため、Safariブラウザでの使用を推奨します

## 💰 料金

### Google Cloud TTS API 無料枠
- **Standard voices**: 毎月400万文字まで無料
- **WaveNet voices**: 毎月100万文字まで無料

### 実質コスト
**個人利用なら完全無料:**
- データ100項目（1項目80文字）= 8,000文字
- 毎日10回繰り返し: 8,000 × 10 × 30日 = 240万文字/月 → **無料範囲内**

### キャッシュによる削減
- 初回のみAPI呼び出し
- 2回目以降はキャッシュから再生（API使用量ゼロ）

## 🛠️ トラブルシューティング

### 「APIキーが設定されていません」
1. 設定を開く
2. APIキーを入力して保存

### 「TTS API Error」
- APIキーが正しいか確認
- Cloud Text-to-Speech APIが有効か確認
- 無料枠を超過していないか確認

### ロック画面で音声が止まる
- **iOS**: Safariを使用（Chrome非推奨）
- **Android**: Chrome/Edgeを使用し、通知権限を許可

### 音声がキャッシュされない
- プライベートモードを使用していないか確認
- ブラウザのストレージ設定を確認
- キャッシュクリア後に再度学習

## 📁 ファイル構成

```
vocabulary-building-assistant2/
├── README.md                      # このファイル
├── TECHNICAL.md                   # 技術仕様書
├── english-learning-app.html     # メインアプリケーション
├── index.html                     # リダイレクト用
└── robots.txt                     # 検索エンジン除外設定
```

## 🔒 セキュリティとプライバシー

### APIキー
- ブラウザのLocalStorageに保存
- デバイスから外部には送信されません

### データ
- Google Sheetsのデータは Google Cloud TTS API に送信されます
- 音声はブラウザのIndexedDBにローカル保存
- 外部サーバーには保存されません

### 推奨設定
- APIキーは必ずText-to-Speech APIのみに制限
- robots.txtで検索エンジンから除外済み

## 🔧 カスタマイズ

詳細なカスタマイズ方法は `TECHNICAL.md` を参照してください。

## ⚖️ ライセンス

このアプリは自由に使用・改変できます。

## 📞 サポート

問題が発生した場合:
1. ブラウザのコンソールでエラーメッセージを確認
2. Google Cloud Consoleで使用状況を確認
3. キャッシュをクリアして再試行
